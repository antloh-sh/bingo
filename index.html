<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Bingo App</title>
  <style>
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      background: #f8f9fb;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 900px;
      margin: 32px auto;
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 2px 16px rgba(0,0,0,0.08);
      padding: 32px;
      border: 1px solid #2684ff;
    }
    .bingo-title {
      font-size: 1.7rem;
      text-align: left;
      font-weight: bold;
      margin-bottom: 12px;
      margin-left: 80px;
      letter-spacing: 0.05em;
    }
    .bingo-layout {
      display: flex;
      flex-direction: row;
      gap: 36px;
      align-items: flex-start;
      justify-content: flex-start;
      padding: 18px 0 0 0;
    }
    .wheel-section {
      flex: 0 0 340px;
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-left: 40px;
    }
    .wheel-canvas {
      cursor: pointer;
      border-radius: 50%;
      box-shadow: 0 2px 8px rgba(50,60,80,0.10);
      background: #f3f7fa;
    }
    .actions {
      text-align: center;
      width: 100%;
      margin-top: 24px;
    }
    .btn {
      font-size: 1rem;
      padding: 12px 28px;
      border-radius: 6px;
      background: #2684ff;
      color: #fff;
      border: none;
      cursor: pointer;
      box-shadow: 0 1px 6px rgba(50,60,80,0.12);
      transition: background 0.18s;
      margin-top: 10px;
    }
    .btn:hover {
      background: #1765b2;
    }
    .table-section {
      flex: 1 0 220px;
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-right: 40px;
    }
    .bingo-table {
      border-collapse: collapse;
      margin-bottom: 16px;
      background: #f9fafc;
      border-radius: 6px;
      overflow: hidden;
      box-shadow: 0 1px 8px rgba(0,0,0,0.04);
      min-width: 210px;
    }
    .bingo-table th, .bingo-table td {
      border: 1px solid #b9cbdf;
      padding: 3px 7px !important;
      text-align: center;
      font-size: 0.95rem !important;
      min-width: 24px;
    }
    .bingo-table th {
      background: #2684ff;
      color: #fff;
      font-weight: bold;
      font-size: 1.1rem;
      letter-spacing: 0.04em;
    }
    .highlighted {
      background: #ffd870 !important;
      color: #222 !important;
      font-weight: bold;
      border-color: #f3c200;
    }
    .modal-bg {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.17);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    .modal {
      background: #fff;
      padding: 32px 40px;
      border-radius: 14px;
      box-shadow: 0 2px 32px rgba(0,0,0,0.19);
      min-width: 240px;
      border: 2px solid #ffd870;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 180px;
      /* Vertically and horizontally center modal content */
    }
    .modal h2 {
      flex: 1;
      font-size: 3.3rem;
      margin: 0;
      color: #174bb2;
      letter-spacing: 0.05em;
      width: 100%;
      text-align: center;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100%;
    }
    @media (max-width: 900px) {
      .container { max-width: 100vw; }
      .bingo-layout { flex-direction: column; gap: 0; }
      .table-section, .wheel-section { margin: 0 auto; }
      .bingo-title { margin-left: 0; text-align:center;}
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="bingo-title">BINGO</div>
    <div class="bingo-layout">
      <div class="wheel-section">
        <canvas id="wheel" width="320" height="320" class="wheel-canvas" title="Spin the wheel"></canvas>
        <div class="actions">
          <button id="newGameBtn" class="btn">New Game</button>
        </div>
      </div>
      <div class="table-section">
        <table id="bingoTable" class="bingo-table"></table>
      </div>
    </div>
  </div>
  <div id="modal-bg" class="modal-bg" style="display:none;">
    <div class="modal">
      <h2 id="modal-number"></h2>
    </div>
  </div>
  <script>
    // Bingo numbers B1-B15, I16-I30, N31-N45, G46-G60, O61-O75
    const bingoNumbers = [];
    for (let i = 1; i <= 75; i++) bingoNumbers.push(i);

    const wheelLabels = [];
    for (let i = 1; i <= 75; i++) {
      let letter = '';
      if (i <= 15) letter = 'B';
      else if (i <= 30) letter = 'I';
      else if (i <= 45) letter = 'N';
      else if (i <= 60) letter = 'G';
      else letter = 'O';
      wheelLabels.push(`${letter}${i}`);
    }

    const wheelCanvas = document.getElementById('wheel');
    const ctx = wheelCanvas.getContext('2d');
    const center = { x: wheelCanvas.width / 2, y: wheelCanvas.height / 2 };
    const radius = 140;
    const logoRadius = 56;
    const pointerLength = 32;
    const pointerWidth = 20;

    let remainingNumbers = [...wheelLabels];
    let pickedNumbers = []; // Strings like 'B1'
    let highlightedNumbers = []; // Numbers like 1

    let spinning = false;
    let spinStart = null;
    let spinDuration = 0;
    let startAngle = 0;
    let spinAngle = 0;
    let finalAngle = 0;
    let winnerIndex = null;
    let winnerLabel = null;
    let currentWheelAngle = 0;

    // Local Storage keys
    const LS_GAME = 'bingoGameState_v4';

    // --- Table Draw ---
    function drawTable() {
      const table = document.getElementById('bingoTable');
      table.innerHTML = '';
      // Header
      const thead = document.createElement('thead');
      const tr = document.createElement('tr');
      ['B', 'I', 'N', 'G', 'O'].forEach(l => {
        const th = document.createElement('th');
        th.textContent = l;
        tr.appendChild(th);
      });
      thead.appendChild(tr);
      table.appendChild(thead);

      // 15 rows, numbers 1-75
      const tbody = document.createElement('tbody');
      for (let row = 0; row < 15; row++) {
        const tr = document.createElement('tr');
        for (let col = 0; col < 5; col++) {
          const num = col * 15 + row + 1;
          if (num > 75) { tr.appendChild(document.createElement('td')); continue; }
          const td = document.createElement('td');
          td.textContent = num;
          if (highlightedNumbers.includes(num)) {
            td.classList.add('highlighted');
          }
          tr.appendChild(td);
        }
        tbody.appendChild(tr);
      }
      table.appendChild(tbody);
    }

    // --- Wheel Draw ---
    function drawWheel(angle = 0, highlightIndex = null) {
      ctx.clearRect(0, 0, wheelCanvas.width, wheelCanvas.height);

      // Draw slices
      const sliceAngle = (2 * Math.PI) / remainingNumbers.length;
      for (let i = 0; i < remainingNumbers.length; i++) {
        const a0 = angle + i * sliceAngle;
        const a1 = a0 + sliceAngle;
        ctx.beginPath();
        ctx.moveTo(center.x, center.y);
        ctx.arc(center.x, center.y, radius, a0, a1, false);
        ctx.closePath();
        // Only white and grey colors
        ctx.fillStyle = (i % 2 === 0) ? '#f7f7f7' : '#e0e0e0';
        if (highlightIndex !== null && i === highlightIndex) {
          ctx.fillStyle = '#ffd870';
        }
        ctx.fill();
        ctx.strokeStyle = '#b9cbdf';
        ctx.lineWidth = 1;
        ctx.stroke();

        // Text label
        ctx.save();
        ctx.translate(center.x, center.y);
        ctx.rotate(a0 + sliceAngle / 2);
        ctx.textAlign = 'center';
        ctx.font = 'bold 13px Segoe UI, Arial';
        ctx.fillStyle = '#2684ff';
        ctx.shadowColor = '#fff';
        ctx.shadowBlur = 3;
        ctx.fillText(remainingNumbers[i], radius - 22, 5);
        ctx.restore();
      }

      // Draw centre logo (clickable area)
      ctx.beginPath();
      ctx.arc(center.x, center.y, logoRadius, 0, 2 * Math.PI);
      ctx.fillStyle = '#fff';
      ctx.fill();
      ctx.strokeStyle = '#2684ff';
      ctx.lineWidth = 3;
      ctx.stroke();

      // Logo image (SVG)
      ctx.save();
      ctx.beginPath();
      ctx.arc(center.x, center.y, logoRadius - 4, 0, 2 * Math.PI);
      ctx.clip();
      const logoImg = new window.Image();
      logoImg.onload = function() {
        ctx.drawImage(logoImg, center.x - (logoRadius - 4), center.y - (logoRadius - 4), (logoRadius - 4) * 2, (logoRadius - 4) * 2);
      };
      logoImg.src = "data:image/svg+xml,%3Csvg width='102' height='102' viewBox='0 0 102 102' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cellipse cx='51' cy='51' rx='51' ry='51' fill='%23fff'%3E%3C/ellipse%3E%3Ccircle cx='51' cy='51' r='38' stroke='%232684ff' stroke-width='5' fill='none'/%3E%3Crect x='32' y='48' width='38' height='14' rx='7' fill='%23ff5544'/%3E%3Crect x='38' y='38' width='26' height='18' rx='6' fill='%23fff'%3E%3C/rect%3E%3Crect x='38' y='39' width='26' height='6' rx='3' fill='%23ff5544'/%3E%3C/svg%3E";
      ctx.restore();

      // Draw pointer at 3 o'clock (right)
      ctx.save();
      ctx.translate(center.x, center.y);
      ctx.rotate(0); // 0 radians = rightwards (3 o'clock)
      ctx.beginPath();
      ctx.moveTo(radius + 4, 0);
      ctx.lineTo(radius + pointerLength, -pointerWidth / 2);
      ctx.lineTo(radius + pointerLength, pointerWidth / 2);
      ctx.closePath();
      ctx.fillStyle = '#bfc2c7';
      ctx.strokeStyle = '#788295';
      ctx.lineWidth = 2;
      ctx.fill();
      ctx.stroke();
      ctx.restore();
    }

    // --- Modal ---
    function showModal(label, duration = 5000) {
      const modalBg = document.getElementById('modal-bg');
      const modalNum = document.getElementById('modal-number');
      // Center number vertically and horizontally
      modalNum.innerHTML = `<span style="width:100%;display:flex;align-items:center;justify-content:center;height:100%;">${label}</span>`;
      modalBg.style.display = 'flex';
      setTimeout(hideModal, duration);
    }
    function hideModal() {
      document.getElementById('modal-bg').style.display = 'none';
    }

    // --- Spin Logic ---
    function startSpin() {
      if (spinning || remainingNumbers.length === 0) return;
      spinning = true;
      spinStart = performance.now();
      spinDuration = 5000 + Math.random() * 2000; // 5-7 seconds
      startAngle = currentWheelAngle; // Start at last wheel position
      spinAngle = 0;
      winnerIndex = null;
      winnerLabel = null;
      animateSpin();
    }

    function animateSpin() {
      const now = performance.now();
      const elapsed = now - spinStart;
      // 120 RPM = 2 rotations/sec = 2*2PI rad/sec
      const totalRotations = 2 * (spinDuration / 1000); // 2 rotations per sec
      // Ease-out cubic
      const t = Math.min(elapsed / spinDuration, 1);
      const ease = 1 - Math.pow(1 - t, 3);
      spinAngle = startAngle + totalRotations * 2 * Math.PI * ease;

      drawWheel(spinAngle);

      if (t < 1) {
        requestAnimationFrame(animateSpin);
      } else {
        currentWheelAngle = spinAngle % (2 * Math.PI);
        // Pointer is at 0 radians (rightwards)
        const pointerAngle = (0 - spinAngle + 2 * Math.PI) % (2 * Math.PI);
        const sliceAngle = (2 * Math.PI) / remainingNumbers.length;
        let idx = Math.floor(pointerAngle / sliceAngle);
        if (idx < 0) idx += remainingNumbers.length;
        winnerIndex = idx % remainingNumbers.length;
        winnerLabel = remainingNumbers[winnerIndex];

        // Highlight the slice
        drawWheel(currentWheelAngle, winnerIndex);

        // Show number in popup for 5 secs
        setTimeout(() => {
          showModal(winnerLabel, 5000);
          // After 5 secs, proceed to pick number
          setTimeout(() => {
            pickNumber();
          }, 5000);
        }, 700);

        spinning = false;
      }
    }

    // --- Table Highlighting ---
    function getNumberFromLabel(label) {
      return parseInt(label.slice(1));
    }

    // --- Pick and Remove Number ---
    function pickNumber() {
      if (winnerIndex === null || winnerLabel === null) return;
      pickedNumbers.push(winnerLabel);
      const num = getNumberFromLabel(winnerLabel);
      highlightedNumbers.push(num);
      // Remove from wheel
      remainingNumbers.splice(winnerIndex, 1);
      saveState();
      drawTable();
      drawWheel(currentWheelAngle);
      winnerIndex = null;
      winnerLabel = null;
    }

    // --- New Game ---
    function resetGame() {
      remainingNumbers = [...wheelLabels];
      pickedNumbers = [];
      highlightedNumbers = [];
      winnerIndex = null;
      winnerLabel = null;
      currentWheelAngle = 0;
      saveState();
      drawTable();
      drawWheel(currentWheelAngle);
    }

    // --- State Persistence ---
    function saveState() {
      const state = {
        remainingNumbers,
        pickedNumbers,
        highlightedNumbers,
        currentWheelAngle
      };
      localStorage.setItem(LS_GAME, JSON.stringify(state));
    }
    function loadState() {
      const str = localStorage.getItem(LS_GAME);
      if (!str) return false;
      try {
        const state = JSON.parse(str);
        if (
          Array.isArray(state.remainingNumbers) &&
          Array.isArray(state.pickedNumbers) &&
          Array.isArray(state.highlightedNumbers)
        ) {
          remainingNumbers = state.remainingNumbers;
          pickedNumbers = state.pickedNumbers;
          highlightedNumbers = state.highlightedNumbers;
          currentWheelAngle = state.currentWheelAngle || 0;
          return true;
        }
      } catch { }
      return false;
    }

    // --- Event Listeners ---
    wheelCanvas.addEventListener('click', function(e) {
      // Only spin if click is inside the logo circle
      const rect = wheelCanvas.getBoundingClientRect();
      const x = e.clientX - rect.left - center.x;
      const y = e.clientY - rect.top - center.y;
      if (Math.sqrt(x * x + y * y) <= logoRadius) {
        startSpin();
      }
    });

    document.getElementById('newGameBtn').addEventListener('click', function() {
      if (confirm('Start a new game? This will reset the wheel and table.')) {
        resetGame();
      }
    });

    // --- Initial Load ---
    function init() {
      if (!loadState()) {
        resetGame();
      } else {
        drawTable();
        drawWheel(currentWheelAngle);
      }
    }
    init();
  </script>
</body>
</html>
